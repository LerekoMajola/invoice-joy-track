

## Replace Messages with Notifications in Portal Header

### What Changes

1. **Remove "Messages" tab** from the bottom navigation bar (both gym and school portals)
2. **Add a bell icon** with unread badge to the top header bar (next to the theme toggle)
3. **Create a notification dropdown/sheet** that shows reminders like payment due, membership expiring, etc.
4. **Create a `portal_notifications` table** to store portal-specific notifications (payment reminders, membership expiry alerts, welcome messages)
5. **Remove the Messages tab case** from the Portal page router

### How It Works

The portal header will have a bell icon. Tapping it opens a slide-up sheet listing notifications sorted by date. Notifications include:
- Membership payment due / overdue reminders
- Membership expiring soon alerts
- Welcome messages
- Any admin-sent alerts

### Files to Change

| File | Change |
|------|--------|
| **Migration** | Create `portal_notifications` table with RLS policies for portal users; seed a trigger or function to auto-generate payment-due notifications |
| `src/components/portal/PortalLayout.tsx` | Remove `messages` from `gymNav` and `schoolNav`; add Bell icon with unread count badge to header; add notification sheet |
| `src/pages/Portal.tsx` | Remove the `case 'messages'` blocks and `PortalMessaging` imports |
| `src/components/portal/PortalLayout.tsx` (type) | Remove `'messages'` from `PortalTab` type |

### Technical Details

**New table: `portal_notifications`**

```sql
CREATE TABLE public.portal_notifications (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  portal_user_id uuid NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  member_id uuid REFERENCES public.gym_members(id) ON DELETE CASCADE,
  type text NOT NULL DEFAULT 'system',  -- 'payment_due', 'membership_expiry', 'system', 'welcome'
  title text NOT NULL,
  message text NOT NULL,
  is_read boolean NOT NULL DEFAULT false,
  created_at timestamptz NOT NULL DEFAULT now()
);

-- RLS: portal users can only read/update their own notifications
ALTER TABLE public.portal_notifications ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Portal users read own notifications"
  ON public.portal_notifications FOR SELECT
  USING (portal_user_id = auth.uid());

CREATE POLICY "Portal users mark own as read"
  ON public.portal_notifications FOR UPDATE
  USING (portal_user_id = auth.uid());
```

**Header notification bell:**
- Bell icon with a small red dot/count badge when unread notifications exist
- Tapping opens a bottom sheet (mobile-friendly) listing notifications
- Each notification can be tapped to mark as read
- Theme-aware styling using `pt()` helper (dark glass vs white cards)

**Bottom nav after change (gym):**
- Home | Progress | Check In | Plan (4 tabs instead of 5)

**Bottom nav after change (school):**
- Home | Fees | Timetable (3 tabs instead of 4)

**Payment due notifications** will be generated by checking `gym_member_subscriptions` where `payment_status = 'pending'` or `end_date` is approaching. A database function will insert these notifications, and they can also be triggered manually by the gym owner.
